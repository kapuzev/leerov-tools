#!/bin/bash

# Функция установки Homebrew
function brewInstall {
    if [ -d /opt/goinfre/$(whoami)/homebrew ]; then
        echo "Homebrew уже установлен в /opt/goinfre/$(whoami)/homebrew"
        return 0
    fi
    
    echo "Установка Homebrew..."
    cd /opt/goinfre/$(whoami)
    git clone https://github.com/Homebrew/brew homebrew
    eval "$(/opt/goinfre/$(whoami)/homebrew/bin/brew shellenv)"
    brew update --force --quiet
    chmod -R go-w "$(brew --prefix)/share/zsh"
    echo "Homebrew успешно установлен"
}

# Функция удаления Homebrew
function brewUninstall {
    if [ -d /opt/goinfre/$(whoami)/homebrew ]; then
        echo "Удаление Homebrew..."
        rm -rf /opt/goinfre/$(whoami)/homebrew
        echo "Homebrew удален"
    else
        echo "Homebrew не установлен в /opt/goinfre/$(whoami)/homebrew"
    fi
}

# Основная функция установки (только устанавливает, если нет)
function brewSetup {
    brewInstall
    brewActivate
}

# Функция переустановки (сначала удаляет, потом устанавливает)
function brewReinstall {
    brewUninstall
    brewInstall
}

# Функция для активации существующей установки Homebrew
function brewActivate {
    if [ -d /opt/goinfre/$(whoami)/homebrew ]; then
        eval "$(/opt/goinfre/$(whoami)/homebrew/bin/brew shellenv)"
        echo "Homebrew активирован"
    else
        echo "Homebrew не найден. Используйте brewSetup для установки"
        return 1
    fi
}

source "installAppOnProfile"