#!/bin/bash

# Функция активации Homebrew (аналог вашей brsw)
function brewActivate {
    if [ -d /opt/goinfre/$(whoami)/homebrew ]; then
        eval "$(/opt/goinfre/$(whoami)/homebrew/bin/brew shellenv)"
        chmod -R go-w "$(brew --prefix)/share/zsh"
        echo "Homebrew активирован"
    else
        echo "Homebrew не найден. Используйте brewSetup для установки"
        return 1
    fi
}

# Функция установки Homebrew (аналог else части вашей brsw)
function brewInstall {
    if [ -d /opt/goinfre/$(whoami)/homebrew ]; then
        echo "Homebrew уже установлен"
        brewActivate
        return 0
    fi
    
    echo "Установка Homebrew..."
    cd /opt/goinfre/$(whoami)
    git clone https://github.com/Homebrew/brew homebrew
    eval "$(/opt/goinfre/$(whoami)/homebrew/bin/brew shellenv)"
    brew update --force --quiet
    chmod -R go-w "$(brew --prefix)/share/zsh"
    brew install lcov
    echo "Homebrew успешно установлен"
}

# Функция удаления Homebrew
function brewUninstall {
    if [ -d /opt/goinfre/$(whoami)/homebrew ]; then
        echo "Удаление Homebrew..."
        rm -rf /opt/goinfre/$(whoami)/homebrew
        echo "Homebrew удален"
    else
        echo "Homebrew не установлен в /opt/goinfre/$(whoami)/homebrew"
    fi
}

# Основная функция (полный аналог вашей brsw)
function brewSetup {
    if [ -d /opt/goinfre/$(whoami)/homebrew ]; then
        eval "$(/opt/goinfre/$(whoami)/homebrew/bin/brew shellenv)"
        chmod -R go-w "$(brew --prefix)/share/zsh"
        echo "Homebrew активирован"
    else
        cd /opt/goinfre/$(whoami)
        git clone https://github.com/Homebrew/brew homebrew
        eval "$(/opt/goinfre/$(whoami)/homebrew/bin/brew shellenv)"
        brew update --force --quiet
        chmod -R go-w "$(brew --prefix)/share/zsh"
        brew install lcov
        echo "Homebrew успешно установлен"
    fi
}

# Функция переустановки (удалить + установить)
function brewReinstall {
    brewUninstall
    brewInstall
}

source "installAppOnProfile"